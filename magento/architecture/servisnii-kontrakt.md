# Сервисный контракт

Magento модульная система, что позволяет сторонним разработчикам дорабатывать и переписывать части ядра фреймворка. Бизнес-логика имеет тенденцию к просачиванию через слои приложения, что проявляется в виде дублированного и несовместиного кода. Владельцы бизнеса часто сопротивляются обновлениям magento поскольку их приобретенные специализированные расширения могут быть невоместимы с новой версией. Также разработчики magento и стронние команды могут посчитать слишком трудным отслеживание и информирование о имеющихся зависимостях их расширений от других. Для решения этой проблемы magento вводит _сервисные контракты_.

## Что такое сервисный контракт?

Сервисный контракт - набор интерфецсов php, определенные в модуле. Сервисные контракты включают _интерфейсы данных_, обеспечивающих целостность данных и _сервисные интерфейсы, _которые скрывают детали бизнес-логики от пользователей сервиса, таких как конроллеры, веб-сервисы и другие модули.

## Шаблоны проектирования сервисного контракта

### Типы интерфейсов и расположение

Сервисный контракт ДОЛЖЕН определять интерфейсы данных и сервисные интерфейсы.

Интерфесы данных определяют методы, возвращающие информацию и сущностях, результатов поиска, установки правил валидации и получения результатов валидации. Вы ДОЛЖНЫ определять интерфейс данных сервсисного контракта в поддиректории **Api/Data** модуля.

Сервисные интерфейсы включают интерфейсы менеджера, репозитория и метаданных. Вы ДОЛЖНЫ определять сервисные интерфейсы в поддиректории **Api** модуля.

### Интерфейсы данных

#### Интерфейс результата поиска данных

Если вы передаете критерии поиска в метод `getList()`, интерфейс результата поиска вернет результаты поиска. Вы ДОЛЖНЫ определить один интерфейс для каждой сущности для контроля типов. Так, метод `getItems()` в `CustomerSearchResultsInterface` возвращает массив сущностей `CustomerInterface`. Метод `getItems()` в `GroupSearchResultsInterface` возвращает массив сущностей `GroupInterface`.

### Сервисные интерфейсы

#### Интерфейс репозитория

Интерфейс репозитория предоставляет доступ к долговременно хранимым данным.

Например, хранимые данные для модуля Customer включают данные Customrer, Address и Group. Следовательно для этого модуля интерфейсы репозитория:

* `CustomerRepositoryInterface`
* `AddressRepositoryInterface`
* `GroupRepositoryInterface`

Репозитории интерфейса ДОЛЖНЫ реализовать следующие методы:

| Метод | Описание |
| :--- | :--- |
| save\(интерфейс сущности\) | если ID не задан, создается новая сущность, если задан - обноляется запись с  ID |
| get\(id\) | Выполняется поиск по ID, возвращается интерфейс сущности, например `CustomerInterface` |
| getList\(критерии поиска\) | Выполняется поиск все сущностей, удовлетворяющих критериям поиска. Возвращается интерфейс результат поиска, дающий доступ к набору искомых данных |
| delete\(интерфейс сущности\) | Удаление конкретной сущности. Сущность содержит ключ \(ID\) |
| deleteById\(id\) | Удаление конкретной сущности по ключу |

#### Интерфейс менеджера

Интерфейс менеджера определяет функции управления, не относящиеся к к репозиторию. Например:

| Интерфейс | Описание |
| :--- | :--- |
| AccountManagementInterface | Определяет методы createAccount, changePassword, activate, isEmailAvailable |
| AddressManagementInterface | Определяет метода валидации адреса validate\(\) |

## Development



